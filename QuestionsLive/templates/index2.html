<!DOCTYPE html>
<html>
<head>
    <title>Quiz</title>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"
     integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+" 
     crossorigin="anonymous"></script>
     <link rel="stylesheet" href="{{ url_for('static', filename='deco.css') }}">
     <!-- Bootstrap -->
     <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  </head>
<body>
    <style>
        body {
  font-family: Arial, sans-serif;
  padding: 20px;
}

h1 {
  font-size: 32px;
  margin-bottom: 20px;
}

form {
  margin-bottom: 20px;
}

label {
  display: block;
  margin-bottom: 10px;
}

button[type="submit"] {
  margin-top: 10px;
}

#connected {
  margin-bottom: 10px;
}

#results {
  margin-top: 20px;
  font-weight: bold;
}

    </style>
    <h1>Quiz</h1>
    <form id="quiz-form">
        <h2>Question 1: What is 2+2?</h2>
    <div class="form-check">
        <input class="form-check-input" type="radio" name="option" id="option1" value="1">
        <label class="form-check-label" for="option1">
          Option 1
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        </label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="option" id="option2" value="2">
        <label class="form-check-label" for="option2">
          Option 2
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        </label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="option" id="option3" value="3">
        <label class="form-check-label" for="option3">
          Option 3
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        </label>
      </div>
      <div class="form-check">
        <input class="form-check-input" type="radio" name="option" id="option4" value="4">
        <label class="form-check-label" for="option4">
          Option 4
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        </label>
      </div>        
        <button type="submit">Submit</button>
    </form>
    <p id="connected">Connected: 0</p>
    <p id="answer-count"></p>
    <p id="results">Results:</p>

    <script>
      var socket = io();
      var connected = document.getElementById('connected');
      var results = document.getElementById('results');
      var quizForm = document.getElementById('quiz-form');
    
      socket.on('connect', function() {
        console.log('Connected');
        socket.emit('connected');
      });
    
      socket.on('disconnect', function() {
        console.log('Disconnected');
      });
    
      socket.on('connected_users', function(count) {
        console.log('Connected users:', count);
        connected.textContent = 'Connected: ' + count;
      });
    
      socket.on('quiz_results', function(resultsData) {
        console.log('Quiz results:', resultsData);
        var totalAnswers = 0;
        for (var answer in resultsData) {
            totalAnswers += resultsData[answer];
        }
        var html = '';
        var options = quizForm.elements['option'];
        for (var i = 0; i < options.length; i++) {
            var option = options[i];
            var answer = option.value;
            var count = resultsData[answer] || 0;
            var progress = totalAnswers > 0 ? Math.round((count / totalAnswers) * 100) : 0;
            html += '<p>' + 'Option' + answer + ': ' + count + '</p>' +
                    '<div class="progress">' +
                    '<div class="progress-bar" role="progressbar" style="width: ' + progress + '%" aria-valuenow="' + progress + '" aria-valuemin="0" aria-valuemax="100"></div>' +
                    '</div>';
        }
        results.innerHTML = '<h2>Results:</h2>' + html;
        updateAnswerCount(Object.values(resultsData).reduce((acc, val) => acc + val, 0));
        });
    
      quizForm.addEventListener('submit', function(event) {
        event.preventDefault();
        var selectedOption = quizForm.querySelector('input[name="option"]:checked');
        if (selectedOption) {
          var answer = selectedOption.value;
          quizForm.reset();
          socket.emit('quiz_answer', answer);
        }
      });

      function updateAnswerCount(count) {
        var answerCount = document.getElementById('answer-count');
        answerCount.textContent = count + ' reponses';
      }

    </script>
    
</body>
</html>